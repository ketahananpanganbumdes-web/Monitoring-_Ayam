<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BUMDes Ketapang - Enterprise System</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap');
        body { font-family: 'Inter', sans-serif; background-color: #f1f5f9; }
        .tab-content { display: none; }
        .tab-content.active { display: block; }

        /* AREA CETAK */
        @media print {
            body * { visibility: hidden; background: white !important; }
            #print-area, #print-area * { visibility: visible; }
            #print-area { 
                position: absolute; left: 0; top: 0; width: 100%; 
                box-shadow: none !important; border: none !important; 
                margin: 0 !important; padding: 10mm !important;
            }
            .no-print { display: none !important; }
            @page { size: auto; margin: 10mm; }
        }

        input, select, textarea { border: 2px solid #e2e8f0 !important; }
        input:focus, select:focus { border-color: #0f172a !important; outline: none; }
    </style>
</head>
<body class="text-slate-900">

    <div id="loading-overlay" class="fixed inset-0 bg-white/80 z-[9999] flex items-center justify-center hidden">
        <div class="flex flex-col items-center text-center">
            <div class="animate-spin rounded-full h-12 w-12 border-t-4 border-b-4 border-slate-900 mb-4"></div>
            <span class="text-xs font-black uppercase tracking-widest">Memproses Data ke Cloud...</span>
        </div>
    </div>

    <div id="login-screen" class="min-h-screen flex items-center justify-center p-6">
        <div class="bg-white p-10 rounded-[40px] shadow-2xl w-full max-w-md text-center border-4 border-slate-900">
            <img src="https://i.ibb.co.com/RG8wTX9W/Logo-Bumdes.png" class="h-20 mx-auto mb-6">
            <h2 class="text-2xl font-black mb-2 italic uppercase">Unit Ketapang Ayam</h2>
            <input type="password" id="pass-input" placeholder="PASSKEY" class="w-full p-4 mb-4 rounded-2xl text-center font-black">
            <button onclick="checkLogin()" class="w-full bg-slate-900 text-white font-black py-4 rounded-2xl hover:bg-slate-800">MASUK SYSTEM</button>
        </div>
    </div>

    <div id="app-content" class="min-h-screen flex flex-col md:flex-row hidden">
        
        <div class="w-full md:w-64 bg-slate-900 text-white p-6 no-print">
            <div class="flex items-center gap-3 mb-10 px-2">
                <div class="w-10 h-10 bg-white rounded-xl flex items-center justify-center text-slate-900"><i class="fas fa-egg"></i></div>
                <span class="font-black italic text-lg uppercase">Ketapang</span>
            </div>
            <nav class="space-y-2">
                <button onclick="showTab('dashboard')" class="w-full flex items-center gap-4 p-4 rounded-2xl hover:bg-slate-800 font-bold text-sm"><i class="fas fa-home w-5"></i> Dashboard</button>
                <button onclick="showTab('monitoring')" class="w-full flex items-center gap-4 p-4 rounded-2xl hover:bg-slate-800 font-bold text-sm"><i class="fas fa-clipboard-list w-5"></i> Monitoring</button>
                <button onclick="showTab('penjualan')" class="w-full flex items-center gap-4 p-4 rounded-2xl hover:bg-slate-800 font-bold text-sm"><i class="fas fa-cart-plus w-5"></i> Penjualan</button>
                <button onclick="showTab('biaya')" class="w-full flex items-center gap-4 p-4 rounded-2xl hover:bg-slate-800 font-bold text-sm"><i class="fas fa-minus-circle w-5"></i> Pengeluaran</button>
                <button onclick="showTab('laporan')" class="w-full flex items-center gap-4 p-4 rounded-2xl hover:bg-slate-800 font-bold text-sm text-yellow-400"><i class="fas fa-file-invoice-dollar w-5"></i> Laporan L/R</button>
                <button onclick="location.reload()" class="w-full flex items-center gap-4 p-4 rounded-2xl bg-red-500/10 text-red-500 font-bold text-sm mt-10"><i class="fas fa-power-off w-5"></i> Keluar</button>
            </nav>
        </div>

        <main class="flex-1 p-6 md:p-10 overflow-y-auto">
            
            <div id="dashboard" class="tab-content active">
                <div class="flex justify-between items-end mb-8">
                    <div>
                        <h1 class="text-3xl font-black italic uppercase italic">Ringkasan Bisnis</h1>
                        <p class="text-xs font-bold text-slate-400 uppercase italic">Unit Ayam Petelur Cikahuripan</p>
                    </div>
                    <button onclick="loadData()" class="p-4 bg-white rounded-2xl shadow-sm hover:text-blue-600"><i class="fas fa-sync"></i></button>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                    <div class="bg-white p-8 rounded-[40px] shadow-sm">
                        <h5 class="text-[10px] font-black uppercase text-slate-400 mb-2">Ayam Hidup</h5>
                        <p id="dash-ayam" class="text-5xl font-black italic">0</p>
                    </div>
                    <div class="bg-slate-900 p-8 rounded-[40px] text-white">
                        <h5 class="text-[10px] font-black uppercase text-slate-500 mb-2">Total Telur (Utuh)</h5>
                        <p id="dash-u" class="text-5xl font-black italic text-yellow-400">0</p>
                    </div>
                    <div class="bg-white p-8 rounded-[40px] shadow-sm">
                        <h5 class="text-[10px] font-black uppercase text-slate-400 mb-2">Saldo Kas Unit</h5>
                        <p id="dash-kas" class="text-4xl font-black italic text-blue-600">Rp 0</p>
                    </div>
                </div>
            </div>

            <div id="monitoring" class="tab-content">
                <div class="max-w-4xl mx-auto bg-white p-8 rounded-[40px] shadow-sm">
                    <h2 class="text-xl font-black mb-6 uppercase border-b-4 border-slate-900 pb-2">Form Monitoring Harian</h2>
                    <form id="formMon" class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div class="md:col-span-2"><label class="text-[10px] font-bold uppercase">Tanggal</label><input type="date" id="mon-A" class="w-full p-4 rounded-2xl bg-slate-50 font-bold" required></div>
                        <div><label class="text-[10px] font-bold uppercase">Ayam Hidup (Ekor)</label><input type="number" id="mon-B" class="w-full p-4 rounded-2xl bg-slate-50 font-bold"></div>
                        <div><label class="text-[10px] font-bold uppercase">Ayam Mati</label><input type="number" id="mon-C" class="w-full p-4 rounded-2xl bg-slate-50 font-bold"></div>
                        <div class="p-4 bg-yellow-50 rounded-[30px] md:col-span-2 grid grid-cols-2 gap-4">
                            <h3 class="col-span-2 text-[10px] font-black text-yellow-600 uppercase italic">Produksi Telur Utuh (Btr & Kg)</h3>
                            <input type="number" id="mon-F" placeholder="Pagi (Btr)" class="p-4 rounded-2xl">
                            <input type="number" id="mon-G" placeholder="Pagi (Kg)" class="p-4 rounded-2xl">
                            <input type="number" id="mon-H" placeholder="Sore (Btr)" class="p-4 rounded-2xl">
                            <input type="number" id="mon-I" placeholder="Sore (Kg)" class="p-4 rounded-2xl">
                        </div>
                        <div class="p-4 bg-red-50 rounded-[30px] md:col-span-2 grid grid-cols-2 gap-4">
                            <h3 class="col-span-2 text-[10px] font-black text-red-600 uppercase italic">Produksi Telur Retak (Btr & Kg)</h3>
                            <input type="number" id="mon-J" placeholder="Pagi (Btr)" class="p-4 rounded-2xl">
                            <input type="number" id="mon-K" placeholder="Pagi (Kg)" class="p-4 rounded-2xl">
                            <input type="number" id="mon-L" placeholder="Sore (Btr)" class="p-4 rounded-2xl">
                            <input type="number" id="mon-M" placeholder="Sore (Kg)" class="p-4 rounded-2xl">
                        </div>
                        <button type="submit" class="md:col-span-2 bg-slate-900 text-white font-black py-5 rounded-[30px] uppercase italic tracking-widest mt-4">Simpan Monitoring</button>
                    </form>
                </div>
            </div>

            <div id="penjualan" class="tab-content">
    <div class="max-w-2xl mx-auto bg-white p-8 rounded-[40px] shadow-sm border-t-8 border-blue-600">
        <h2 class="text-xl font-black mb-6 uppercase text-blue-600">Input Penjualan Telur</h2>
        <form id="formJual" class="space-y-4">
            <div>
                <label class="text-[10px] font-bold uppercase">Nama Pembeli</label>
                <input type="text" id="jual-nama" placeholder="Contoh: Toko Berkah" class="w-full p-4 rounded-2xl bg-slate-50 font-bold" required>
            </div>
            
            <div class="grid grid-cols-2 gap-4">
                <div>
                    <label class="text-[10px] font-bold uppercase">Jumlah (Kg)</label>
                    <input type="number" step="0.01" id="jual-kg" placeholder="0.00" class="w-full p-4 rounded-2xl bg-slate-50 font-bold" oninput="hitungTotalJual()" required>
                </div>
                <div>
                    <label class="text-[10px] font-bold uppercase">Harga per Kg (Rp)</label>
                    <input type="number" id="jual-harga" placeholder="Contoh: 26000" class="w-full p-4 rounded-2xl bg-slate-50 font-bold" oninput="hitungTotalJual()" required>
                </div>
            </div>

            <div>
                <label class="text-[10px] font-bold uppercase">Total Nominal (Otomatis)</label>
                <input type="number" id="jual-nom" placeholder="Total Rp" class="w-full p-4 rounded-2xl bg-blue-50 font-black text-blue-700 border-2 border-blue-200" readonly>
            </div>

            <div>
                <label class="text-[10px] font-bold uppercase">Metode Kas</label>
                <select id="jual-kas" class="w-full p-4 rounded-2xl bg-slate-50 font-bold italic">
                    <option value="KAS TUNAI">KAS TUNAI</option>
                    <option value="BANK/TRANSFER">BANK/TRANSFER</option>
                </select>
            </div>

            <button type="submit" class="w-full bg-blue-600 text-white font-black py-5 rounded-[30px] uppercase italic tracking-widest mt-4">Simpan Penjualan</button>
        </form>
    </div>
</div>

            <div id="biaya" class="tab-content">
                <div class="max-w-2xl mx-auto bg-white p-8 rounded-[40px] shadow-sm border-t-8 border-red-500">
                    <h2 class="text-xl font-black mb-6 uppercase text-red-500">Input Pengeluaran / Biaya</h2>
                    <form id="formBiaya" class="space-y-4">
                        <select id="biaya-kat" class="w-full p-4 rounded-2xl bg-slate-50 font-bold italic">
                            <option value="PAKAN">PAKAN</option>
                            <option value="OBAT/VAKSIN">OBAT/VAKSIN</option>
                            <option value="GAJI/HOK">GAJI/HOK</option>
                            <option value="LISTRIK/AIR">LISTRIK/AIR</option>
                            <option value="LAIN-LAIN">LAIN-LAIN</option>
                        </select>
                        <select id="biaya-sumber" class="w-full p-4 rounded-2xl bg-slate-50 font-bold italic">
                            <option value="KAS TUNAI">AMBIL DARI KAS TUNAI</option>
                            <option value="BANK/TRANSFER">AMBIL DARI BANK</option>
                        </select>
                        <textarea id="biaya-ket" placeholder="Keterangan Rinci..." class="w-full p-4 rounded-2xl bg-slate-50 font-bold" rows="3"></textarea>
                        <input type="number" id="biaya-nom" placeholder="Nominal Keluar (Rp)" class="w-full p-4 rounded-2xl bg-slate-50 font-bold" required>
                        <button type="submit" class="w-full bg-red-500 text-white font-black py-5 rounded-[30px] uppercase italic tracking-widest">Simpan Pengeluaran</button>
                    </form>
                </div>
            </div>

            <div id="laporan" class="tab-content">
                <div id="print-area" class="bg-white p-10 rounded-[40px] shadow-2xl max-w-4xl mx-auto">
                    <div class="text-center mb-10 border-b-4 border-double border-slate-900 pb-6">
                        <img src="https://i.ibb.co.com/RG8wTX9W/Logo-Bumdes.png" class="h-16 mx-auto mb-4">
                        <h1 class="text-2xl font-black uppercase tracking-tighter">Laporan Laba Rugi Unit Ketapang</h1>
                        <p id="rep-tgl" class="mt-2 text-xs font-black bg-slate-900 text-white px-4 py-1 rounded-full inline-block uppercase italic"></p>
                    </div>

                    <div class="grid grid-cols-2 gap-6 mb-8">
                        <div class="p-6 bg-slate-50 rounded-[30px] border border-slate-200">
                            <h5 class="text-[9px] font-black uppercase text-slate-400 mb-4 italic">Kinerja Produksi</h5>
                            <div class="space-y-2 text-xs font-bold uppercase italic">
                                <div class="flex justify-between border-b border-dashed pb-1"><span>Utuh</span> <span id="r-u">0</span> Btr</div>
                                <div class="flex justify-between border-b border-dashed pb-1"><span>Retak</span> <span id="r-r">0</span> Btr</div>
                                <div class="flex justify-between text-blue-700"><span>Ayam Hidup</span> <span id="r-ayam">0</span> Ekor</div>
                            </div>
                        </div>
                        <div class="p-6 bg-slate-50 rounded-[30px] border border-slate-200 flex flex-col justify-center items-center">
                            <h5 class="text-[9px] font-black uppercase text-slate-400 mb-2 italic">HDP Harian</h5>
                            <p id="r-hdp" class="text-4xl font-black italic text-slate-900">0%</p>
                        </div>
                    </div>

                    <div class="border-2 border-slate-900 rounded-[30px] overflow-hidden mb-10">
                        <table class="w-full text-xs text-left">
                            <thead class="bg-slate-900 text-white uppercase text-[10px] italic font-black">
                                <tr><th class="p-4">Deskripsi Akuntansi</th><th class="p-4 text-right">Nilai (IDR)</th></tr>
                            </thead>
                            <tbody class="font-bold italic uppercase">
                                <tr class="border-b">
                                    <td class="p-4">Total Pendapatan (In)</td>
                                    <td id="r-in" class="p-4 text-right text-blue-600">0</td>
                                </tr>
                                <tr class="border-b">
                                    <td class="p-4">Total Beban Operasional (Out)</td>
                                    <td id="r-out" class="p-4 text-right text-red-500">0</td>
                                </tr>
                                <tr class="bg-slate-50 border-b">
                                    <td class="p-4 text-slate-400">Penyusutan Kandang (Flat)</td>
                                    <td id="r-sk" class="p-4 text-right text-slate-400">0</td>
                                </tr>
                                <tr class="bg-slate-50 border-b text-slate-400">
                                    <td class="p-4">Penyusutan Biologis (Ayam Hidup)</td>
                                    <td id="r-sa" class="p-4 text-right">0</td>
                                </tr>
                                <tr class="bg-yellow-300 text-slate-900 text-sm">
                                    <td class="p-4 font-black">Laba/Rugi Bersih (Net Profit)</td>
                                    <td id="r-net" class="p-4 text-right font-black">Rp 0</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>

                    <div class="grid grid-cols-2 gap-20 text-center text-[10px] font-black uppercase italic mt-10">
                        <div><p class="mb-20">Ketua BUMDes Cikahuripan,</p><p class="border-t-2 border-slate-900 pt-2 mx-10">( ............................ )</p></div>
                        <div><p class="mb-20">Kepala Unit Produksi,</p><p class="border-t-2 border-slate-900 pt-2 mx-10">( ............................ )</p></div>
                    </div>

                    <button onclick="window.print()" class="no-print w-full mt-10 bg-slate-900 text-white font-black py-5 rounded-2xl uppercase italic hover:scale-[1.01] transition-all">
                        <i class="fas fa-print mr-2"></i> Cetak Laporan Sekarang
                    </button>
                </div>
            </div>
        </main>
    </div>

    <script>
        const CLOUD_URL = "https://script.google.com/macros/s/AKfycbx5AbwPfZhsVQXRbq3p2qNYOovwAfWKMdOFfbJ4PUeEZ1WOshEawF3OAAf_qXRuLvnXfA/exec";
        let db = { sum: {} };

        function checkLogin() {
            if(document.getElementById('pass-input').value === "1234") {
                document.getElementById('login-screen').classList.add('hidden');
                document.getElementById('app-content').classList.remove('hidden');
                loadData();
            } else { alert("Passkey Salah!"); }
        }

        function showTab(id) {
            document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
            document.getElementById(id).classList.add('active');
        }
         // Fungsi hitung otomatis Total Nominal
    function hitungTotalJual() {
        const kg = document.getElementById('jual-kg').value || 0;
        const harga = document.getElementById('jual-harga').value || 0;
        const total = kg * harga;
        document.getElementById('jual-nom').value = total;
    }

    // Update Handler Submit Penjualan
    document.getElementById('formJual').onsubmit = (e) => {
        e.preventDefault();
        sendData({
            sheet: "Penjualan",
            nama: document.getElementById('jual-nama').value,
            kg: document.getElementById('jual-kg').value,
            harga: document.getElementById('jual-harga').value,
            nominal: document.getElementById('jual-nom').value,
            kas: document.getElementById('jual-kas').value
        });
        // Reset form setelah kirim
        e.target.reset();
    };

        async function loadData() {
            document.getElementById('loading-overlay').classList.remove('hidden');
            try {
                const response = await fetch(CLOUD_URL);
                db.sum = await response.json();
                updateUI();
            } finally { document.getElementById('loading-overlay').classList.add('hidden'); }
        }

        function updateUI() {
            const s = db.sum;
            document.getElementById('dash-ayam').innerText = s.ayam.toLocaleString();
            document.getElementById('dash-u').innerText = s.total_btr_u.toLocaleString();
            document.getElementById('dash-kas').innerText = "Rp " + (s.total_in - s.total_out).toLocaleString();
            
            document.getElementById('r-u').innerText = s.total_btr_u.toLocaleString();
            document.getElementById('r-r').innerText = s.total_btr_r.toLocaleString();
            document.getElementById('r-ayam').innerText = s.ayam.toLocaleString();
            document.getElementById('r-hdp').innerText = s.ayam > 0 ? ((s.total_btr_u / s.ayam) * 100).toFixed(1) + "%" : "0%";
            document.getElementById('r-in').innerText = "+ " + s.total_in.toLocaleString();
            document.getElementById('r-out').innerText = "- " + s.total_out.toLocaleString();
            document.getElementById('r-sk').innerText = "- " + Math.round(s.susut_kandang).toLocaleString();
            document.getElementById('r-sa').innerText = "- " + Math.round(s.susut_ayam).toLocaleString();
            document.getElementById('r-net').innerText = "Rp " + Math.round(s.laba_bersih).toLocaleString();
            document.getElementById('rep-tgl').innerText = "DATA PER: " + new Date().toLocaleString('id-ID');
        }

        async function sendData(payload) {
            document.getElementById('loading-overlay').classList.remove('hidden');
            await fetch(CLOUD_URL, { method: 'POST', body: JSON.stringify(payload) });
            loadData();
            alert("Data Berhasil Tersimpan!");
        }

        document.getElementById('formMon').onsubmit = (e) => {
            e.preventDefault();
            sendData({
                sheet: "Monitoring",
                A: document.getElementById('mon-A').value,
                B: document.getElementById('mon-B').value, C: document.getElementById('mon-C').value,
                F: document.getElementById('mon-F').value, G: document.getElementById('mon-G').value,
                H: document.getElementById('mon-H').value, I: document.getElementById('mon-I').value,
                J: document.getElementById('mon-J').value, K: document.getElementById('mon-K').value,
                L: document.getElementById('mon-L').value, M: document.getElementById('mon-M').value
            });
        };

        document.getElementById('formJual').onsubmit = (e) => {
            e.preventDefault();
            sendData({
                sheet: "Penjualan",
                nama: document.getElementById('jual-nama').value,
                kas: document.getElementById('jual-kas').value,
                nominal: document.getElementById('jual-nom').value
            });
        };

        document.getElementById('formBiaya').onsubmit = (e) => {
            e.preventDefault();
            sendData({
                sheet: "Biaya",
                kat: document.getElementById('biaya-kat').value,
                sumber: document.getElementById('biaya-sumber').value,
                ket: document.getElementById('biaya-ket').value,
                nominal: document.getElementById('biaya-nom').value
            });
        };
    </script>
</body>
</html>
